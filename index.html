<!doctype html>
<html lang="en" data-framework="circularJS">
<head>
  <meta charset="utf-8">
  <title>Circular.js • Demo</title>

  <link rel="stylesheet" type="text/css" href="index.css">

  <!-- <script type="text/javascript" src="amd.js"></script>
  <script type="text/javascript" src="toolbox.js"></script>
  <script type="text/javascript" src="VOM.js"></script>
  <script type="text/javascript" src="schnauzer.js"></script>
  <script type="text/javascript" src="blick.js"></script>
  <script type="text/javascript" src="circular.js"></script> -->
  <script type="text/javascript" src="circular.min.js"></script>
</head>
<body>
  <div class="circularjs">
    <div class="circularjs-logo"></div>
    <div class="circularjs-text">
      ircul<span class="span">a</span>r<em class="em">JS</em></div>
    <div class="circularjs-creator">
      by <em class="em">WeekendProductions<sup class="sup">©</sup></em>
    </div>
  </div>


  <section cr-component="counter" cr-container>
    <span cr-template-for="counter" class="items">
      Button counter: {{%items}} button{{#%plural}}s{{/%plural}} left
    </span>
  </section>

  <section cr-component="buttons" cr-container>
    <div
      cr-template-for="buttons"
      cr-event="click: clicker; mousedown: preventSelect"
      class="item{{#if %last}} last{{/if}}"
    >
      Clicks{{#maxClicks}} (max {{.}}){{/maxClicks}}: {{%clicks}} so far
    </div>
  </section>

</body>

<script type="text/javascript">
require(['circular'], function(Circular) {

  var demo = window.demo = new Circular();
  var buttonsModel = [{
      clicks: 0,
      maxClicks: 10,
      last: false,
    }, {
      clicks: 0,
      maxClicks: 2,
      last: false,
    }, {
      clicks: 0,
      maxClicks: 1,
      last: false,
    }];

  var buttons = demo.component('buttons', {
      model: buttonsModel,
      listeners: ['clicks', 'last'],
      subscribe: function(property, item, value, oldValue) {
        if (property === 'clicks') {
          if (item.maxClicks && value > item.maxClicks) {
            this.removeChild(item);
          }
        } else { // removeChild | prependChild ...
          updateCounter(item.parentNode.childNodes.length);
        }
      },
      eventListeners: {
        clicker: function(e, element, item) {
          item.clicks++;
          item.last = item.maxClicks &&
            item.maxClicks - item.clicks === 0;
        },
        preventSelect: function(e, element, item) {
          e.preventDefault();
        }
      }
    });
  var updateCounter = function(itemsCount) {
      counterModel.items = itemsCount;
      counterModel.plural = itemsCount !== 1;
    };

  var itemsCount = buttons.getElementsByProperty().length;
  var counterModel = {
      items: itemsCount,
      plural: itemsCount !== 1
    }
  var counter = demo.component('counter', {
      model: [counterModel],
      listeners: ['items', 'plural'],
    });

  // ---------- test for prependChild and resulting order ---------- //
  var more = [{
      clicks: 0,
      maxClicks: 8,
      last: false,
    }, {
      clicks: 0
    }];

  for (var n = 0, l = more.length; n < l; n++) {
    buttons.prependChild(more[n]);
  }

  console.log(demo);
});
</script>
</html>
