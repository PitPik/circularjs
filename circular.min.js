!function(e){"use strict";var t=e.require||{},n=e.Math.random,r=null,o=0,i={},s=document.createElement("a"),a=function(e,t){if("object"!=typeof t||!t)return t;e=e||{};for(var n in t)e[n]=t[n].constructor===Array?t[n]:"object"==typeof t[n]?a(e[n],t[n]):t[n];return e},l=function(e){for(var t=["lookaheadMap","paths","options","baseUrl"],n=t.length;n--;)b[t[n]]=a(b[t[n]],e[t[n]])||b[t[n]]||""},c=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return n;return-1},u=function(e,t,n){return n=/(?:^\!|^http[s]*:|.*\.js$)/.test(e)?"":".js",e=(b.paths[e]||e).replace(/^\!/,""),p((b.baseUrl||".")+"/"+e+n).replace(/^.\//,"")},p=function(e){return s.href=e,(-1!==e.indexOf(s.host)?s.origin:"")+s.pathname+s.search},d=function(t,n){var r=e.document.createElement("script");return r.type="text/javascript",r.async=r.defer=!n,r.charset="utf-8",r.onload=r.onreadystatechange=function(e){"load"!==e.type&&"complete"!==(e.currentTarget||e.srcElement).readyState||(t.factory||v(t),r.onload=r.onreadystatechange=null)},r.src=t.path,r},h=function(t){(r=r||e.document.createDocumentFragment()).appendChild(t),clearTimeout(o),o=setTimeout(function(){document.head.appendChild(r)},0)},f=function(e){for(var t=0,n=e.resolvedDeps.length;n--;)void 0!==e.resolvedDeps[n]&&t++;e.deps.length===t&&v(e)},m=function(e){for(var t=null,n=0,r=0,o=e.parentNames.length;r<o;r++)t=x[e.parentNames[r]],n=c(t.deps,e.name),t.resolvedDeps[n]=e.done,!t.done&&f(t);e.parentNames=[]},v=function(e){e.done||(e.done=(e.factory||function(){}).apply(null,e.resolvedDeps)),m(e),b.options.debug||(delete e.factory,e.name.indexOf("_mod"))},g=function(e){var t=b.lookaheadMap[e];if(t&&-1===(b.paths[e]||"").indexOf(b.options.minifyPrefix)){b(t);for(var n=0,r=t.length;n<r;n++)b.lookaheadMap[t[n]]&&!x[t[n]]&&g(t[n])}};if(!e.define||!e.define.amd){var y=e.define=function(e,t,n,r){var o=[];if("string"!=typeof e)return i=b(e,t,n);if(x[e]){if(x[e].done)return m(x[e]),x[e].done;x[e].deps=t,x[e].factory=n}else x[e]={name:e,deps:t,factory:n,resolvedDeps:[],parentNames:[]};for(var s=0,a=t.length;s<a;s++)o=x[t[s]]&&x[t[s]].parentNames,x[t[s]]?-1===c(o,e)&&o.push(e):(x[t[s]]={name:t[s],isFile:"!"===t[s].substr(0,1),path:u(t[s]),resolvedDeps:[],parentNames:[e]},x[t[s]].isFile?b.getFile(x[t[s]],v):(h(d(x[t[s]],r)),g(t[s]))),x[t[s]].done&&m(x[t[s]]);return f(x[e]),x[e]},b=e.require=function(e,t,r){return e.constructor===Array?y("_mod"+(n()+n()),e,t,r):y("_mod"+(n()+n()),[],e,t)},x=b.modules={},E=b.config=function(e){l(t=e)};b.getFile=function(e,t){return e},y.amd={},E(t)}}(this),function(e,t){"object"==typeof exports?module.exports=t(e):"function"==typeof define&&define.amd?define("toolbox",[],function(){return t(e)}):e.Toolbox=t(e)}(this,function(e,t){"use strict";function n(e){var t=document.cookie.split(e+"=")[1];return t&&t.split(";")[0]}function r(e,t,n){try{if(e.readyState===XMLHttpRequest.DONE){if(!(e.status<200||e.status>299))return e["xml"===t?"responseXML":"responseText"];var r=new Error(e.statusText);r.response=e.response,n(r)}}catch(e){n("Caught Exception: "+e.stack)}}function o(e){this._state=0,this._handled=!1,this._value=t,this._deferreds=[],c(e,this)}function i(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,setTimeout(function(){var n,r=1===e._state?t.onFulfilled:t.onRejected;if(null!==r){try{n=r(e._value)}catch(e){return void a(t.promise,e)}s(t.promise,n)}else(1===e._state?s:a)(t.promise,e._value)})):e._deferreds.push(t)}function s(e,t){try{if(t){var n=t.then;if(t instanceof o)return e._state=3,e._value=t,void l(e);if("function"==typeof n)return void c(n.bind(t),e)}e._state=1,e._value=t,l(e)}catch(t){a(e,t)}}function a(e,t){e._state=2,e._value=t,l(e)}function l(e){2===e._state&&0===e._deferreds.length&&setTimeout(function(){e._handled||console.warn("Possible Unhandled Promise Rejection:",e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)i(e,e._deferreds[t]);e._deferreds=null}function c(e,t){var n=!1,r=function(e){n||(n=!0,a(t,e))};try{e(function(e){n||(n=!0,s(t,e))},r)}catch(e){r(e)}}var u=null,p=document.createElement("a"),d={closest:function(e,t,n){for(;e!==n&&e.parentNode;){if(e.matches(t))return e;e=e.parentNode}},$:function(e,t){return(t||document.body).querySelector(e)},$$:function(e,t){return(t||document.body).querySelectorAll(e)},parentsIndexOf:function(e,t){for(var n=e.length;n--;)if(e[n].contains(t))return n;return-1},addClass:function(e,t){e&&e.classList.add(t)},removeClass:function(e,t){e&&e.classList.remove(t)},toggleClass:function(e,t,n){if(e){var r=e.classList.contains(t);r&&!n?e.classList.remove(t):r||!1===n||e.classList.add(t)}},hasClass:function(e,t){return e&&e.classList.contains(t)},toggleClasses:function(e,t,n,r){e&&n&&d.removeClass(e,n),t&&d.addClass(t,r||n)},addEvents:function(e,t,n,r,o){for(var i=e.length;i--;)d.addEvent(e[i],t,n,r,o)},removeEvents:function(e,t,n){for(var r=t.length;r--;)d.removeEvent(e,t[r],n)},addEvent:function(e,t,n,r,o){d.addEvent.events=d.addEvent.events||[],d.addEvent.events.push({e:e,t:t,f:n,c:r,i:o||d}),e.addEventListener(t,n,r)},removeEvent:function(e,t,n){var r={},o=!1,i=0;for(i=(d.addEvent.events||[]).length;i--;)r=d.addEvent.events[i],o=!t||r.e===t&&(!n||n===r.t),r.i===(e||d)&&o&&(r.e.removeEventListener(r.t,r.f,r.c),d.addEvent.events.splice(i,1))},storageHelper:{fetch:function(e){var t=localStorage.getItem(e);return t?JSON.parse(t):t},saveLazy:function(e,t,n){d.lazy(function(){d.storageHelper.save(e,t)},n||d.storageHelper)},save:function(e,t){localStorage.setItem(t,JSON.stringify(e))}},lazy:function(e,t){clearTimeout(t._timer),t._timer=setTimeout(e,0)},itemsSorter:function(e,t,n,r){var o=e[n].toUpperCase(),i=t[n].toUpperCase();return r?o<i?1:o>i?-1:0:o<i?-1:o>i?1:0},normalizePath:function(e){return p.href=e,(-1!==e.indexOf(p.host)?p.origin:"")+p.pathname+p.search},ajax:function(e,o){var i=null,s=!1,a=(new Date).getTime(),l=0;return o=o||{},e=d.normalizePath(e),l=h[e]&&h[e].time||0,s=!0===o.cache?a+1e8:o.cache?l>a?l:a+o.cache:0,i=s&&!o.resetCache&&l>a?h[e]:null,i=i||new d.Promise(function(i,s){var a=new XMLHttpRequest,l=(o.method||o.type||"GET").toUpperCase();if(a||s("Giving up :( Cannot create an XMLHTTP instance"),o||(e=(o=e).url),a.onreadystatechange=function(){var e=r(this,o.dataType,s);if(e!==t){if("json"===o.dataType)try{e=JSON.parse(e)}catch(e){return void s("Caught Exception: "+e.stack)}i(e)}},a.open(l,e,o.async||!0,o.username,o.password),"xml"===o.dataType&&a.setRequestHeader("Content-Type","text/xml"),"GET"!==l&&o.csrf&&a.setRequestHeader("X-CSRF-Token",n(o.csrf)),o.headers)for(var c in o.headers)a.setRequestHeader(c,o.headers[c]);a.send(o.data)}),s?(h[e]=i,h[e].time=s):delete h[e],i},errorHandler:function(e){console.error(e)},Promise:o,requireResources:function(e,t,n){var r=[],o=null,i="",s="",a="",l="styles"===t,c=l?"href":"src",p=l?e.links.concat(e.styles):e.scripts;for(u=u||d.captureResources();p.length;)o=p.shift(),i=o.getAttribute(c),s=d.normalizePath(e.path?e.path+"/"+i:""+i),i&&u[s]||(l||(a=o.text,(o=document.createElement("script")).setAttribute("type","text/javascript"),o.async=!0,i||(o.text=a),r.push(new d.Promise(function(e){i?o.onload=function(){e(this)}:(n&&n.appendChild(o),e(o))}))),i?(o[c]=s,document.head.appendChild(o),u[s]=o):n&&l&&n.appendChild(o));return 0===r.length&&r.push(new d.Promise(function(e){e(function(){})})),d.Promise.all(r)},captureResources:function(){for(var e={},t=[].slice.call(d.$$("script",document)).concat([].slice.call(d.$$("link",document))),n="",r=t.length;r--;)(n=t[r].getAttribute("src")||t[r].getAttribute("href"))&&(e[n=d.normalizePath(n)]=t[r]);return e}};e.Event=e.Event||function(e,t){var n=document.createEvent("CustomEvent");return t=t||{},n.initCustomEvent(e,t.bubbles||!1,t.cancelable||!1,t.detail),n};var h={};return o._cache={},o.prototype.catch=function(e){return this.then(null,e||function(e){console.error(e)})},o.prototype.then=function(e,t){var n=new o(function(){});return i(this,{onFulfilled:e||null,onRejected:t||null,promise:n}),n},o.prototype.cancel=function(e){var t=o._cache[e];return t&&(t._deferreds=[],t.then=t.catch=function(){},t._handled=!0),o._cache[e]=this},o.all=function(e){var t=[];return e.reduce(function(e,n){return e.then(function(){return n}).then(function(e){return t.push(e)})},new o(function(e,t){e(null)})).then(function(){return t})},e.require&&(require.getFile=function(e,t){d.ajax(e.path,{cache:"!!"!==e.name.substr(0,2)}).then(function(n){e.done=n,t(e)})}),d}),function(e,t){"object"==typeof exports?module.exports=t(e):"function"==typeof define&&define.amd?define("schnauzer",[],function(){return t(e)}):e.Schnauzer=t(e)}(this,function(e,t){"use strict";function n(e,t){var n="{{"===t[0]?["{{2,3}","}{2,3}"]:t,r=e.options.characters;e.variableRegExp=new RegExp("("+n[0]+")([>!&=])*([\\w\\"+r+"\\.]+)\\s*([\\w"+r+"\\.\\s]*)"+n[1],"g"),e.sectionRegExp=new RegExp("("+n[0]+")([#^])([\\w"+r+"]*)(?:\\s+([\\w$\\s|./"+r+"]*))*("+n[1]+")((?:(?!\\1[#^])[\\S\\s])*?)\\1\\/\\3\\5","g"),e.elseSplitter=new RegExp(n[0]+"else"+n[1])}function r(e,t){for(var n=0,r=e.length;n<r;n++)t[t.length]=e[n];return t}function o(e,n,o,i){var s=o!==t;return{extra:n?r(n,s&&e.extra||[]):s&&e.extra||[],path:s?r(e.path,[o]||[]):e.path||[e],helpers:i?r(e.helpers||[],s&&[i]||[{}]):e.helpers||[]}}function i(e,t){for(var n=0,r=t.length;n<r;n++)e=e&&e[t[n]];return e}function s(e,n,r,o){var s=e.path[o]||{},a=e.helpers[o]||{},l=a[n]!==t?a[n]:i(a,r);if(l!==t&&"."!==r[0]||(l=s[n]!==t?s[n]:i(s,r)),l!==t)return l;for(var c=e.extra.length;c--;){if(e.extra[c][n]!==t)return e.extra[c][n];if((l=i(e.extra[c],r))!==t)return l}}function a(e){var t=e.split(/\s*=\s*/),n=t.length>1?t[1]:t[0],r='"'===n.charAt(0)||"'"===n.charAt(0),o=0,i=[],s=[],a=!1;return r?n=n.replace(/(?:^['"]|['"]$)/g,""):((s=n.split("../")).length>1&&(n=("@"===s[0]&&"@"||"")+s.pop(),o=s.length),name=name.replace(/^(?:\.|this)\//,function(){return a=!0,""}),i=n.split(/[\.\/]/),n=n.replace(/^\.\//,function(){return a=!0,i[0]=".",""})),{name:t.length>1?t[0]:n,value:n,isString:r,strict:a,keys:i,depth:o}}function l(e,t){return String(e).replace(t.entityRegExp,function(e){return t.options.entityMap[e]})}function c(e,t,n,r,o){return{getData:function(e){return(e=n.rawParts[e]||{value:e,keys:[e],depth:0}).isString?e.value:s(t,e.value,e.keys,e.depth)},escapeHtml:function(t){return l(t,e)},getBody:function(){return r&&r(t)||""},gatAltBody:function(){return o&&o(t)||""},data:t.path[0]}}function u(e,t,n,r){return t&&(e[t[0]]=r,e[t[1]]=n),e}function p(e,t,n,r,o){for(var i=e.options,s={},l={},c=t.length,u={};c--;)s[(u=a(t[c])).name]=u,l[t[c]]=u;return{name:n.name,vars:t,parts:s,rawParts:l,partial:">"===o&&(e.partials[n.name]||e.partials[i.recursion]),isUnescaped:!i.doEscape||"&"===o||r,depth:n.depth,strict:n.strict,keys:n.keys}}function d(e,n,r){var i=[],u=e.options.splitter;return n=n.replace(e.variableRegExp,function(t,n,r,o,s){var l=r&&r.charAt(0)||"";return"-section-"===o?(i.push({section:s}),u):"!"===l||"="===l?"":(s=s.split(/\s+/),i.push(p(e,s,a(o),"{{{"===n,l)),u)}).split(u),function(a){for(var u,p,d,h,f,m=0,v=n.length,g="";m<v;m++)if(g+=n[m],(f=i[m])!==t)if(f.section)g+=r[f.section](a)||"";else{if(f.partial){h={};for(var b in a.path[0])h[b]=a.path[0][b];for(var x in f.parts)d=f.parts[x],h[x]=d.isString?d.value:s(a,d.value,d.keys,d.depth);u=f.partial(o(h))}else u=s(a,f.name,f.keys,f.depth),u=(p=!f.strict&&e.options.helpers[f.name]||y(u)&&u)?p.apply(c(e,a,f),f.vars):u&&(f.isUnescaped?u:l(u,e));u!==t&&(g+=u)}return g}}function h(e,n,r,i,l,d){var h=r;r=a(!i.length||"if"!==r&&"each"!==r&&"with"!==r&&"unless"!==r?r:i.shift());var f="as"===i[0]&&[i[1],i[2]];return i=p(e,i,a(r.name),l,""),function(a){var l=s(a,r.name,r.keys,r.depth),p=g(l),m="each"===h&&!p&&"object"==typeof l&&l;if(l="unless"===h?!l:m?b(l,[]):l,p||m){if(d)return l.length?"":n[0](l);a.path.unshift({}),a.helpers.unshift({});for(var v=0,x=l.length,E="";v<x;v++)a.path[0]=p?l[v]:m[l[v]],a.helpers[0]=u({"@index":""+v,"@last":v===x-1,"@first":!v,".":a.path[0],this:a.path[0],"@key":p?v:l[v]},f,p?v:l[v],a.path[0]),E+=n[0](a);return a.path.shift(),a.helpers.shift(),E}var C=!r.strict&&e.options.helpers[r.name]||y(l)&&l;return C?C.apply(c(e,a,i,n[0],n[1]),i.vars):d&&!l||!d&&l?n[0]("unless"===h||"if"===h?a:o(a,t,l,u({".":l,this:l,"@key":r.name},f,r.name,l))):n[1]&&n[1](a)}}function f(e,t){for(var n="",r=[],i=e.options.tags;n!==t&&(n=t);)t=t.replace(e.sectionRegExp,function(t,n,o,s,a,l,c){return c=c.split(e.elseSplitter),r.push(h(e,[d(e,c[0],r),c[1]&&d(e,c[1],r)],s,a&&a.replace(/\|/g,"").split(/\s+/)||[],"{{{"===n,"^"===o)),i[0]+"-section- "+(r.length-1)+i[1]});return t=d(e,t,r),function(e,n){return t(o(e,n&&(g(n)&&n||[n])))}}var m=function(e,t){this.version="1.2.0",this.options={tags:["{{","}}"],entityMap:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},doEscape:!0,helpers:{},partials:{},recursion:"self",characters:'$"<>%-=@',splitter:"|##|"},v(this,t||{},e)},v=function(e,t,r){for(var o in t)e.options[o]=t[o];t=e.options,e.entityRegExp=new RegExp("["+b(t.entityMap,[]).join("")+"]","g"),n(e,t.tags),e.partials={};for(var i in t.partials)e.registerPartial(i,t.partials[i]);r&&e.registerPartial(t.recursion,r)},g=Array.isArray||function(e){return e&&e.constructor===Array},y=function(e){return e&&"function"==typeof e},b=Object.keys||function(e,t){for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t};return m.prototype={render:function(e,t){return this.partials[this.options.recursion](e,t)},parse:function(e){return this.partials[this.options.recursion]||this.registerPartial(this.options.recursion,e)},registerHelper:function(e,t){this.options.helpers[e]=t},unregisterHelper:function(e){delete this.options.helpers[e]},registerPartial:function(e,t){return this.partials[e]=f(this,t)},unregisterPartial:function(e){delete this.partials[e]},setTags:function(e){n(this,e)}},m}),function(e,t){"object"==typeof exports?module.exports=t(e):"function"==typeof define&&define.amd?define("VOM",[],function(){return t(e)}):e.VOM=t(e)}(this,function(e){"use strict";function t(e,n){for(var r=n.length;r--;)n[r][e.options.childNodes]&&t(e,n[r][e.options.childNodes]),delete m[e.id][n[r][e.options.idProperty]],n.pop();return n}function n(e,t){return(t.parentNode?r(t.parentNode,e.options.childNodes):e.model).indexOf(t)}function r(e,t){return e[t]=e[t]||[],e[t]}function o(e,t,n,o,l,c){return e.options.moveCallback.call(e,t,l,c),t.parentNode?e.options.parentCheck&&s(e,t,n):a([t],e,n,l,c),e.type=l,e.sibling=c,t.parentNode===n&&o>t.index&&-1!==t.index&&o--,t=-1!==t.index&&t.parentNode&&i(e,t,!0)||t,r(n,e.options.childNodes).splice(o||0,0,t),t.parentNode=n,t}function i(e,n,o){return!o&&t(e,[n]),r(n.parentNode,e.options.childNodes).splice(n.index,1)[0]||n}function s(e,t,n){var r=n;for(t===n&&d("ERROR: can't move element inside itself",e.options);r=r.parentNode;)r===t&&d("ERROR: can't move parent inside it's own child",e.options)}function a(e,t,n,r,o){t.options;for(var i=!1,s=!0,c=t.options.idProperty,u={},p=0,d=e.length;p<d;p++)i=!(u=e[p]).parentNode,u[c]||(u[c]="vom_"+v++,s=!1),m[t.id][u[c]]=u,u.parentNode=n||t.model.root,u.index=0,i&&(u=l(t,u,s)),t.options.preRecursionCallback.call(t,u,r,o),u[t.options.childNodes]&&a(u[t.options.childNodes],t,u),t.options.enrichModelCallback.call(t,u,r,o);return e}function l(e,t,n){var r=!1,o=e.options.listeners,i=0,s=0,a="",l="",u="",p="",d={},h={},f=[];for(var m in t)if(i=o[m]&&o[m].length-1){s=o[m].indexOf("*"),d=y(t,o[m],s>-1?i-s+1:1),f=(a=(p=o[m].join(".")).split("*")[1]||"").split(".").splice(1);for(var v in d)h=a?y(d[v],f,1):d,l=p.replace("*",v),u=f[f.length-1]||v,e.addProperty(u,[h,t],l)}else r="parentNode"===m||m===g,m===e.options.idProperty?c(t,m,t[m],n):(o[m]||o["*"]||r)&&e.addProperty(m,t,null,r);return t}function c(e,t,n,r,o){return delete e[t],Object.defineProperty(e,t,{enumerable:!!o,configurable:!1,writable:!!r,value:n})}function u(e,t,r,o,i,s,a){return Object.defineProperty(t[0]||t,e,{get:function(){return e===i?n(o,t[0]||t):r[a||e]},set:function(n){var s=r[a||e];r[a||e]=n,p(a||e,t,n,s,r,o,i)},enumerable:s})}function p(e,t,n,r,o,i,s){(e===i.options.idProperty||e===s||i.options.subscribe.call(i,i.type||e,t[1]||t,n,r,i.sibling))&&(o[e]=r,d("ERROR: Cannot set property '"+e+"' to '"+n+"'",i.options)),delete i.type,delete i.sibling}function d(t,n){if(!n.throwErrors&&void 0!==e&&e.console)return console.warn?console.warn(t):console.log(t);throw t}var h=function(e,t){this.options={parentCheck:!1,idProperty:"id",subscribe:function(){},enrichModelCallback:function(){},preRecursionCallback:function(){},moveCallback:function(){},listeners:[],childNodes:"childNodes",throwErrors:!1},this.model=e||[],f(this,t||{})},f=function(e,t){var n="",r={};m.push({}),c(e,"id",m.length-1);for(var o in t)e.options[o]=t[o];for(;n=e.options.listeners.shift();)n=n.split("."),e.options.listeners[n[0]]=n;r[e.options.childNodes]=e.model,c(e.model,"root",r),a(e.model,e)},m=[],v=0,g="index",y=function(e,t,n){for(var r=0,o=t.length-(n||0);r<o;r++)e=e&&e[t[r]];return e};return h.prototype={getElementById:function(e){return m[this.id][e]},getElementsByProperty:function(e,t){var n=[],r=void 0!==t,o=void 0!==e,i=[],s=null;for(var a in m[this.id])s=void 0!==m[this.id][a][e]?m[this.id][a][e]:y(m[this.id][a],i[0]?i:i=o&&e.split(".")),(r&&s===t||!r&&void 0!==s||!r&&!o)&&n.push(m[this.id][a]);return n},appendChild:function(e,t){return t=t||this.model.root,o(this,e,t,r(t,this.options.childNodes).length,"appendChild",t)},prependChild:function(e,t){return t=t||this.model.root,o(this,e,t,0,"prependChild",t)},insertBefore:function(e,t){return o(this,e,t.parentNode,t.index,"insertBefore",t)},insertAfter:function(e,t){return o(this,e,t.parentNode,t.index+1,"insertAfter",t)},replaceChild:function(e,t){var n=t.index,r=t.parentNode;return e!==t&&i(this,t),o(this,e,r,n,"replaceChild",t),t},removeChild:function(e){return i(this,e),this.options.subscribe.call(this,"removeChild",e),e},sortChildren:function(e,t,n){for(var r=0,o=(t=(t||this.model).sort(e)).length;r<o;r++)this.options.subscribe.call(this,"sortChildren",t[r]),n&&t[r][this.options.childNodes]&&this.sort(e,t[r][this.options.childNodes],n)},reinforceProperty:c,addProperty:function(e,t,n,r){var o={};o[n||e]=(t[0]||t)[e],u(e,t,o,this,g,!r,n)},getProperty:function(e,t){return y(t,e.split("."))},getCleanModel:function(e){return JSON.parse(JSON.stringify(e||this.model))},destroy:function(){return t(this,this.model)}},h}),function(e,t){"object"==typeof exports?module.exports=t(e,require("toolbox"),require("schnauzer"),require("VOM")):"function"==typeof define&&define.amd?define("circular",["toolbox","schnauzer","VOM"],function(n,r,o){return t(e,n,r,o)}):e.Circular=t(e,e.Toolbox,e.Schnauzer,e.VOM)}(this,function(e,t,n,r){"use strict";function o(e,t,n){for(var r=0,o=t.length;r<o;r++)t[r].call(e,n)}function i(n,r,i){var a=void 0!==e.onpopstate?"popstate":"hashchange";t.addEvent(e,a,function(e){var t={};for(var a in n)(t=c(n[a],s(i)))&&o(r,n[a],t)},r.id)}function s(e){return decodeURI(e?location.hash.substr(e.length):location.pathname+location.search)}function a(e){var t=[];return e=e.replace(/[\-{}\[\]+?.,\\\^$|#\s]/g,"\\$&").replace(/\((.*?)\)/g,"(?:$1)?").replace(/(\(\?)?:\w+/g,function(e,n){return t.push(e.substr(1)),n?e:"([^/?]+)"}).replace(/\*/g,"([^?]*?)"),{regexp:new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$"),names:t}}function l(e){for(var t=0,n=(e=e?e.split("&"):[]).length,r={},o=[];t<n;t++)r[(o=e[t].split("="))[0]]=o[1];return r}function c(e,t){var n=e.regexp&&e.regexp.exec(t),r={};if(!n)return null;for(var o=0,i=(n=n.slice(1)).length;o<i;o++)n[o]=n[o]?o===i-1?n[o]:decodeURIComponent(n[o]):null,e.names[o]&&(r[e.names[o]]=n[o]);return n.parameters=r,n.queries=l(n[i-1]),n.path=t.replace(/^\//,"").split("/"),n}function u(e){for(var t=[].slice.call(e.container.childNodes),n=0,r=t.length;n<r;n++)P[e.previousName].cache.appendChild(t[n])}function p(e,t,n,r,o,i,s){var a="prependChild"===n,l={};"string"==typeof t?(e.innerHTML=t,(l=e.children[0])&&l.setAttribute(i,s)):l=t;return l&&((a||"insertAfter"===n)&&(o=o&&o.nextSibling||a&&r.children[0],n=o?"insertBefore":"appendChild"),(r||l.parentElement)[n](l,o)),l}function d(e,t,n){for(var r=N(v(e.viewAttr),n),o="",i=(r=[n].concat([].slice.call(r))).length;i--;)(o=r[i].getAttribute(e.viewAttr))&&(t[o]=r[i])}function h(e,t,n,r,o){for(var i in e.prototype)r[i]||(o[i]=function(e){return function(){return t[e].apply(t,arguments)}}(i));return o}function f(e,t,n){var r=[],o=f.tempContainer=f.tempContainer||document.createDocumentFragment(),i=[],s={};if(n)for(a=n.length;a--;)(s=n[a])[2][s[1]?"insertBefore":"appendChild"](s[0],s[1]),n[a]=null;else if(e&&t){if(0!==(r=N(v(t),e)).length)for(var a=0,l=r.length;a<l;a++)s=r[a],i.push([s,s.nextElementSibling,s.parentNode]),o.appendChild(s);return i}}function m(e,t,r,o){for(var i=r||document.body,s=e.containerAttr,a=r.hasAttribute(s)?r:C(v(s,o),r)||C(v(s),r),l=C(v(e.templateAttr,o),i),c=N(v(e.templatesAttr,o),i)||[],u={},p=c.length;p--;)u[c[p].id||c[p].getAttribute("name")]=new(e.Template||n)(c[p].innerHTML,{doEscape:!1,helpers:t.helpers||e.helpers||{}});return{element:r,template:l?l.innerHTML:l,templates:u,container:a}}function v(e,t){return"["+e+(t?'="'+t+'"]':"]")}function g(e,n,r,o){var i,s=(t.closest(e.target,v(n))||r.element).getAttribute(n),a="elements.element",l=r.getElementById(s)||r.getElementsByProperty(a,r.element)[0]||r.getElementsByProperty(a,e.target)[0]||r.model[0],c=l&&l.events[e.type],u={},p=!1;for(var d in c)if(i=o.options.eventListeners[d])for(var h=c[d].length;h--;)u=c[d][h],p||u!==e.target&&!u.contains(e.target)||(p=!1===i.call(r,e,u,l))&&e.stopPropagation()}var y=function(e,t){this.options={componentAttr:"cr-component",containerAttr:"cr-container",templateAttr:"cr-template-for",templatesAttr:"cr-template",eventAttribute:"cr-event",viewAttr:"cr-view",devAttribute:"cr-dev",mountAttribute:"cr-mount",elements:"elements",events:"events",views:"views",hash:"#"},b(this,e,t)},b=function(e,n,r){var o="string"==typeof n;o||(r=n);for(var i in r)e.options[i]=r[i];e.version="0.1.0",e.components={},e.data={},e.id="cr_"+_++,e.Toolbox=t,e.name=o?n:e.id},x=function(e){this.options={appElement:document.body,eventAttribute:"cr-event"},E(this,e)},E=function(e,t){for(var n in t)e.options[n]=t[n];e.events={}},C=(e.requestAnimationFrame||e.webkitRequestAnimationFrame,t.$),N=t.$$,_=0,A={},w={},k=null,R={},P={};return y.prototype.component=function(e,o){if(this.components[e])return this.components[e].reset(o.model,o.extraModel);this.data[e]={};var i=this,s={},a={},l=this.options,c=l.elements,u=l.componentAttr,g=v(u,e),y=o.componentElement||C(g,o.componentWrapper||document);if(y){var b=f(y,u),E=y&&y.getAttribute("name"),N=m(l,o,y,E||e),_=this.components[e]={name:e,model:o.model||[],element:N.element,container:N.container,templates:N.templates},k=o.storage,P=k||{},M=t.storageHelper,T=k&&M.fetch(P.name)||{},L=P.category,O=P.listeners||o.listeners,S=P.storeAll||O&&-1!==O.indexOf("*"),j=o.mountSelector||v(l.mountAttribute),q=o.template;if(this.data[e].extraModel=o.extraModel||l.extraModel,R[this.name]=R[this.name]||{},R[this.name][e]={},A[this.id]=A[this.id]||{},s=A[this.id][e]={},s.helper=document.createElement("tbody"),o.onBeforeInit&&o.onBeforeInit(_),s.controller=o.eventListeners&&new x({appElement:N.element,eventAttribute:l.eventAttribute,eventListeners:o.eventListeners,instanceID:i.id}),s.template=q&&q.version?q:w[e]?w[e]:N.template?new(l.Template||n)(q||N.template,{doEscape:!1,helpers:o.helpers||l.helpers||{}}):null,s.template&&(w[e]=s.template),k){var H=T[L]||T;for(var $ in _.model[0])H&&void 0!==H[$]&&(_.model[0][$]=H[$])}return s.vom=new r(_.model,{idProperty:i.options.idProperty||"cr-id",preRecursionCallback:function(t,n,r){var a=this.options.idProperty,u=t[a],h=s.template&&s.template.partials.self&&s.template.render(t,i.data[e].extraModel),f="replaceChild"===n&&r[c].element,m=t.parentNode[c]&&t.parentNode[c].container,v=h&&g||m||_.container,g=v?f||void 0:r&&r[c].element,y=h&&p(s.helper,h,n||"appendChild",v,g,a,u)||_.element;this.reinforceProperty(t,c,{element:y,container:C(j,y)},!0),this.reinforceProperty(t,l.events,{},!0),s.controller&&s.controller.getEventListeners(t[c].element||_.element,t[l.events],_,a),this.reinforceProperty(t,l.views,{},!0),d(l,t[l.views],t[c].element||_.element),o.preRecursionCallback&&o.preRecursionCallback.call(this,t)},enrichModelCallback:this.options.enrichModelCallback||o.enrichModelCallback||function(){},listeners:this.options.listeners||o.listeners||[],subscribe:function(t,n,r,a,u){var h=this.options.idProperty,f=(n[h],n[c]&&n[c].element),m=n.parentNode&&n.parentNode[c]?n.parentNode[c].container||n.parentNode[c].element:_.container;"removeChild"===t?p(s.helper,f,t,f.parentElement):"sortChildren"===t?p(s.helper,f,"appendChild",m):this[t]?n===u?(f=p(s.helper,s.template.render(n,i.data[e].extraModel),t,m,u[c].element,h,n[h]),n[c].element=f,n[c].container=C(j,f),n[l.events]={},s.controller&&s.controller.getEventListeners(n[c].element||_.element,n[l.events],_,this.options.idProperty),n[l.views]={},d(l,n[l.views],n[c].element||_.element)):"replaceChild"!==t&&p(s.helper,f,t,m,u[c]&&u[c].element):k&&(S||-1!==O.indexOf(t))&&(T=M.fetch(P.name)||{},S?T[L]=_.model[0]:(T[L]=T[L]||{},T[L][t]=r),M[!1===P.saveLazy?"save":"saveLazy"](L?T:T[L],P.name,this)),o.subscribe&&o.subscribe.call(this,t,n,r,a),i.publish(_,e,t,{property:t,item:n,value:r,oldValue:a})}}),f(null,null,b),a=h(r,s.vom,0,this,a),a.uncloak=function(e){var e=e&&e.element||_.element;t.removeClass(e,"cr-cloak"),e.removeAttribute("cr-cloak")},a.reset=function(e,t){t&&(i.data[_.name].extraModel=t),s.vom.destroy(),this.container&&(this.container.innerHTML="");for(var n=0,r=e.length;n<r;n++)this.appendChild(e[n]);return _},_.__proto__=a,o.onInit&&o.onInit(_),_}},y.prototype.destroy=function(e){var t=A[this.id],n={};for(var r in t)if(!e||e===r)for(var o in t[r])(n=t[r][o])&&n.destroy&&n.destroy(r)},y.prototype.model=function(e,t){return new r(e,t)},y.prototype.template=function(e,t){return new n(e,t)},y.Toolbox=t,y.prototype.subscribe=function(e,t,n,r,o){if(e=e?e.name||e.components&&e.components[t]||e:this.name,R[e]=R[e]||{},(t=R[e][t]=R[e][t]||{})[n]=t[n]||[],r&&(t[n].push(r.callback||r),r.regexp&&!t[n].regexp&&(t[n].regexp=r.regexp,t[n].names=r.names)),n&&t[n])return o&&void 0!==t[n].value&&(r.callback||r).call(this,t[n].value),r.callback||r;delete R[e]},y.prototype.publish=function(e,t,n,r){e="string"==typeof e?e:this.name,R[e]=R[e]||{},R[e]&&((t=R[e][t]=R[e][t]||{})[n]=t[n]||[],t[n].value=r,t[n][0]&&o(this,t[n],r))},y.prototype.unsubscribe=function(e,t,n,r){var o=-1,i={};return e=e||this.name,R[e]&&R[e][t]&&R[e][t][n]&&-1!==(o=(i=R[e][t][n]).indexOf(r.callback||r))&&i.splice(o,1),r.callback||r},y.prototype.addRoute=function(e,t,n){var r="object"==typeof e.path?{regexp:e.path}:a(e.path),o=n||this.options.hash,l=c(r,s(o)),u=R[this.name]&&R[this.name].__router;return this.subscribe(null,"__router",e.path,{callback:e.callback,names:r.names,regexp:r.regexp||r},t),t&&l&&e.callback.call(this,l),!u&&i(R[this.name].__router,this,o),e},y.prototype.removedRoute=function(e){return this.unsubscribe(null,"__router",e.path,e.callback)},y.prototype.toggleRoute=function(e,t){var n=R[this.name].__router,r=n[e.path].paused||n[e.path];n[e.path]=t?r:[],n[e.path].paused=t?null:r},y.prototype.loadResource=function(e,n){var r=this,o=function(e){return!e.hasAttribute(r.options.devAttribute)};return t.ajax(e,{cache:n}).then(function(t){var n=[],r=e.split("/").slice(0,-1);return k=k||document.implementation.createHTMLDocument(""),k.documentElement.innerHTML=t,n=[].slice.call(N("script",k)||[]).filter(function(e){return"text/javascript"===e.getAttribute("type")&&(e.parentNode.removeChild(e),o(e))}),{links:[].slice.call(N("link",k)||[]).filter(o),styles:[].slice.call(N("style",k)||[]).filter(o),scripts:n,body:C("body",k),head:C("head",k),path:r.join("/")}}).catch()},y.prototype.insertResources=function(e,n){var r=C(v(this.options.devAttribute,"container"),n.body)||n.body;for(t.requireResources(n,"styles",e);r.childNodes[0];)e.appendChild(r.childNodes[0]);return t.requireResources(n,"scripts",e)},y.prototype.insertModule=function(e,t){var n=this;return this.loadResource(e,!0).then(function(e){return n.insertResources(t,e).then(function(){return e.path})})},y.prototype.renderModule=function(e){var n=null,r=null,o=e.container,i=P,s=e.name;return i[e.previousName]&&u(e),s&&i[s]?(e.container.appendChild(i[s].cache),i[s].init&&!1!==e.init&&i[s].init(e.data,i[s].path),new t.Promise(function(e){e(i[s].init)})):(n=document.createDocumentFragment(),o||((r=document.createElement("div")).style.display="none",document.body.appendChild(r)),s?this.insertModule(e.path,e.container||r).then(function(a){return new t.Promise(function(t){var l=!0===e.require?s:!1===e.require?"":e.require;i[s]={path:a,cache:n},l?require([l],function(n){i[s].init=n,!1!==e.init&&n(e.data,a),o||(e.container=r,u(e),r.parentElement.removeChild(r)),t(n)}):r&&(u(e),r.parentElement.removeChild(r),t())})}).catch():new t.Promise(function(e){e()}))},x.prototype={getEventListeners:function(e,t,n,r){for(var o=this.options.eventAttribute,i=e.querySelectorAll(v(o)),s="",a="",l="",c="",u=[],p={},d=e!==n.element?n.element:[],h=(i=[e].concat([].slice.call(i),d)).length;h--;)if(s=i[h].getAttribute(o))for(var f=(u=s.split(/\s*;+\s*/)).length;f--;)l=(a=u[f].split(/\s*:+\s*/))[0],c=a[1],void 0===(p=t[l]=t[l]||{})[c]&&(p[c]=[]),p[c].push(i[h]),this.events[l]||(this.events[l]=!0);this.installed||this.installEventListeners(n,r)},installEventListeners:function(e,n){var r=this;for(var o in this.events)t.addEvent(this.options.appElement,o,function(t){g(t,n,e,r)},!!/(?:focus|blur)/.test(o),this.options.instanceID+"_"+e.name);this.installed=!0},destroy:function(e){t.removeEvent(this.options.instanceID+"_"+e.name)}},y});