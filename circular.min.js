!function(e){"use strict";var t=e.require||{},n=e.Math.random,r=null,o=0,i=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return n;return-1},s=function(e,t,n){return n=/(?:^\/|^http[s]*:|.*\.js$)/.test(t)?"":".js",t=n?a((m.baseUrl||".")+"/"+(m.paths[e]||e)+n).replace(/^.\//,""):e},a=function(e){for(var t=[],n=e.split("/"),r=e.match(/^([./]*)/g)[0],o=0;o<n.length;++o)".."===n[o]?t.pop():""!==n[o]&&"."!==n[o]&&t.push(n[o]);return r+t.join("/").replace(/[\/]{2,}/g,"/")},l=function(t,n){var r=e.document.createElement("script");return r.type="text/javascript",r.async=r.defer=!n,r.charset="utf-8",r.onload=r.onreadystatechange=function(e){"load"!==e.type&&"complete"!==(e.currentTarget||e.srcElement).readyState||(t.factory||d(t),r.onload=r.onreadystatechange=null)},r.src=t.path,r},c=function(t){(r=r||e.document.createDocumentFragment()).appendChild(t),clearTimeout(o),o=setTimeout(function(){document.head.appendChild(r)},0)},u=function(e){for(var t=0,n=e.resolvedDeps.length;n--;)void 0!==e.resolvedDeps[n]&&t++;e.deps.length===t&&d(e)},p=function(e){for(var t=null,n=0,r=0,o=e.parentNames.length;r<o;r++)t=v[e.parentNames[r]],n=i(t.deps,e.name),t.resolvedDeps[n]=e.done,!t.done&&u(t);e.parentNames=[]},d=function(e){e.done||(e.done=(e.factory||function(){}).apply(null,e.resolvedDeps)),p(e),m.options.debug||(delete e.factory,e.name.indexOf("_mod"))},f=function(e){var t=m.lookaheadMap[e];if(t&&-1===(m.paths[e]||"").indexOf(m.options.minifyPrefix)){m(t);for(var n=0,r=t.length;n<r;n++)m.lookaheadMap[t[n]]&&!v[t[n]]&&f(t[n])}};if(!e.define||!e.define.amd){var h=e.define=function(e,t,n,r){var o=[];if("string"!=typeof e)return m(e,t,n);if(v[e]){if(v[e].done)return p(v[e]),v[e].done;v[e].deps=t,v[e].factory=n}else v[e]={name:e,deps:t,factory:n,resolvedDeps:[],parentNames:[]};for(var a=0,d=t.length;a<d;a++)o=v[t[a]]&&v[t[a]].parentNames,v[t[a]]?-1===i(o,e)&&o.push(e):(v[t[a]]={name:t[a],path:s(t[a]),resolvedDeps:[],parentNames:[e]},c(l(v[t[a]],r)),f(t[a])),v[t[a]].done&&p(v[t[a]]);return u(v[e]),v[e]},m=e.require=function(e,t,r){return e.constructor===Array?h("_mod"+(n()+n()),e,t,r):h("_mod"+(n()+n()),[],e,t)},v=m.modules={},g=m.config=function(e){!function(e){for(var t=["lookaheadMap","paths","options","baseUrl"],n=t.length;n--;)m[t[n]]=e[t[n]]||m[t[n]]||""}(t=e)};h.amd={},g(t)}}(this),function(e,t){"object"==typeof exports?module.exports=t(e):"function"==typeof define&&define.amd?define("toolbox",[],function(){return t(e)}):e.Toolbox=t(e)}(this,function(e,t){"use strict";function n(e){this._state=0,this._handled=!1,this._value=t,this._deferreds=[],a(e,this)}function r(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,setTimeout(function(){var n,r=1===e._state?t.onFulfilled:t.onRejected;if(null!==r){try{n=r(e._value)}catch(e){return void i(t.promise,e)}o(t.promise,n)}else(1===e._state?o:i)(t.promise,e._value)})):e._deferreds.push(t)}function o(e,t){try{if(t){var r=t.then;if(t instanceof n)return e._state=3,e._value=t,void s(e);if("function"==typeof r)return void a(r.bind(t),e)}e._state=1,e._value=t,s(e)}catch(t){i(e,t)}}function i(e,t){e._state=2,e._value=t,s(e)}function s(e){2===e._state&&0===e._deferreds.length&&setTimeout(function(){e._handled||console.warn("Possible Unhandled Promise Rejection:",e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)r(e,e._deferreds[t]);e._deferreds=null}function a(e,t){var n=!1,r=function(e){n||(n=!0,i(t,e))};try{e(function(e){n||(n=!0,o(t,e))},r)}catch(e){r(e)}}var l=null,c={closest:function(e,t,n){for(;e!==n&&e.parentNode;){if(e.matches(t))return e;e=e.parentNode}},$:function(e,t){return(t||document.body).querySelector(e)},$$:function(e,t){return(t||document.body).querySelectorAll(e)},parentsIndexOf:function(e,t){for(var n=e.length;n--;)if(e[n].contains(t))return n;return-1},addClass:function(e,t){e&&e.classList.add(t)},removeClass:function(e,t){e&&e.classList.remove(t)},toggleClass:function(e,t,n){if(e){var r=e.classList.contains(t);r&&!n?e.classList.remove(t):r||!1===n||e.classList.add(t)}},hasClass:function(e,t){return e&&e.classList.contains(t)},toggleClasses:function(e,t,n,r){e&&n&&c.removeClass(e,n),t&&c.addClass(t,r||n)},addEvents:function(e,t,n,r,o){for(var i=e.length;i--;)c.addEvent(e[i],t,n,r,o)},removeEvents:function(e,t,n){for(var r=t.length;r--;)c.removeEvent(e,t[r],n)},addEvent:function(e,t,n,r,o){c.addEvent.events=c.addEvent.events||[],c.addEvent.events.push({e:e,t:t,f:n,c:r,i:o||c}),e.addEventListener(t,n,r)},removeEvent:function(e,t,n){var r={},o=!1,i=0;for(i=(c.addEvent.events||[]).length;i--;)r=c.addEvent.events[i],o=!t||r.e===t&&(!n||n===r.t),r.i===(e||c)&&o&&(r.e.removeEventListener(r.t,r.f,r.c),c.addEvent.events.splice(i,1))},storageHelper:{fetch:function(e){return JSON.parse(localStorage.getItem(e)||"[]")},saveLazy:function(e,t){c.lazy(function(){c.storageHelper.save(e,t)},c.storageHelper)},save:function(e,t){localStorage.setItem(t,JSON.stringify(e))}},lazy:function(e,t){clearTimeout(t.timer),t.timer=setTimeout(e,0)},itemsSorter:function(e,t,n,r){var o=e[n].toUpperCase(),i=t[n].toUpperCase();return r?o<i?1:o>i?-1:0:o<i?-1:o>i?1:0},normalizePath:function(e){for(var t=[],n=e.split("/"),r=e.match(/^([./]*)/g)[0],o=0;o<n.length;++o)".."===n[o]?t.pop():""!==n[o]&&"."!==n[o]&&t.push(n[o]);return r+t.join("/").replace(/[\/]{2,}/g,"/")},ajax:function(e,n){var r=null;return n=n||{},r=n.cache&&!n.resetCache&&u[e]||new c.Promise(function(r,o){var i=new XMLHttpRequest,s=(n.method||n.type||"GET").toUpperCase();if(i||o("Giving up :( Cannot create an XMLHTTP instance"),n||(e=(n=e).url),i.onreadystatechange=function(){var e=function(e,t,n){try{if(e.readyState===XMLHttpRequest.DONE){if(200===e.status)return e["xml"===t?"responseXML":"responseText"];n("There was a problem with the xhr request.")}}catch(e){n("Caught Exception: "+e.stack)}}(this,n.dataType,o);if(e!==t){if("json"===n.dataType)try{e=JSON.parse(e)}catch(e){return void o("Caught Exception: "+e.stack)}r(e)}},i.open(s,e,n.async||!0,n.username,n.password),"xml"===n.dataType&&i.setRequestHeader("Content-Type","text/xml"),"GET"!==s&&n.csrf&&i.setRequestHeader("X-CSRF-Token",function(e){var t=document.cookie.split(e+"=")[1];return t&&t.split(";")[0]}(n.csrf)),n.headers)for(var a in n.headers)i.setRequestHeader(a,n.headers[a]);i.send(n.data)}),n.cache&&(u[e]=r),r},errorHandler:function(e){console.error(e)},Promise:n,requireResources:function(e,t,n){var r=[],o=null,i="",s="",a="",u="styles"===t,p=u?"href":"src",d=u?e.links.concat(e.styles):e.scripts;for(l=l||c.captureResources();d.length;)i=(o=d.shift()).getAttribute(p),s=c.normalizePath(e.path?e.path+"/"+i:""+i),i&&l[s]||(u||(a=o.text,(o=document.createElement("script")).setAttribute("type","text/javascript"),o.async=!0,i||(o.text=a),r.push(new c.Promise(function(e){o.onload?o.onload=function(){e(this)}:e(o)}))),i?(o[p]=s,document.head.appendChild(o),l[s]=o):n&&n.appendChild(o));return 0===r.length&&r.push(new c.Promise(function(e){e(function(){})})),c.Promise.all(r)},captureResources:function(){for(var e={},t=[].slice.call(c.$$("script",document)).concat([].slice.call(c.$$("link",document))),n="",r=t.length;r--;)(n=t[r].getAttribute("src")||t[r].getAttribute("href"))&&(e[n=c.normalizePath(n)]=t[r]);return e}};e.Event=e.Event||function(e,t){var n=document.createEvent("CustomEvent");return t=t||{},n.initCustomEvent(e,t.bubbles||!1,t.cancelable||!1,t.detail),n};var u={};return n.prototype.catch=function(e){return this.then(null,e||function(e){console.error(e)})},n.prototype.then=function(e,t){var o=new n(function(){});return r(this,{onFulfilled:e||null,onRejected:t||null,promise:o}),o},n.all=function(e){var t=[];return e.reduce(function(e,n){return e.then(function(){return n}).then(function(e){return t.push(e)})},new n(function(e,t){e(null)})).then(function(){return t})},c}),function(e,t){"object"==typeof exports?module.exports=t(e):"function"==typeof define&&define.amd?define("schnauzer",[],function(){return t(e)}):e.Schnauzer=t(e)}(this,function(e,t){"use strict";function n(e,t){var n="{{"===t[0]?["{{2,3}","}{2,3}"]:t;e.options.tags=n,e.variableRegExp=new RegExp("("+n[0]+")([>!&=]\\s*)*([\\w\\"+e.options.characters+"\\.\\s*]+)*"+n[1],"g"),e.sectionRegExp=new RegExp(n[0]+"(#|\\^)([\\w\\.]*)\\s*(.*?)"+n[1]+"([\\S\\s]*?)("+n[0]+")\\/\\2("+n[1]+")","g")}function r(e){return e&&e.constructor===Array}function o(e){return e&&"function"==typeof e}function i(e,t){for(var n=0,r=t.length;n<r;n++)e=e&&e[t[n]];return e}function s(e,n,r){if("string"==typeof r){var o=[],s=e[r]!==t?e[r]:i(e,o=r.split("."));if(s!==t)return s;for(var a=n.length;a--;){if(n[a][r]!==t)return n[a][r];if(s=i(n[a],o))return s}}}function a(e,t){return String(e).replace(t.entityRegExp,function(e){return t.options.entityMap[e]})}function l(e,t,n){return{getData:function(e){return s(t,n,e)},escapeHtml:function(t){return a(t,e)}}}function c(e,n){var r=[],i=e.options;return n=n.replace(e.variableRegExp,function(t,n,o,s){var a=o&&("!"===o[0]||"="===o[0]),l=!i.doEscape||"{{{"===n||o&&"&"===o[0],c=o&&">"===o[0],u=!1,p="",d={};if(a)return"";if(s=s.split(/\s+/),p=s.shift(s),c)for(var f=s.length,h=[];f--;)d[(h=s[f].split("="))[1]?h[0]:"$"+f]=(h[1]?h[1]:h[0]).replace(/"/g,"");return u=p===i.recursion,r.push(c&&(e.partials[p]||u)?[e.partials[p],d,c,l,u]:[p,s,null,l]),i.splitter}).split(i.splitter),function(c,u,p){p&&(u=[p].concat(u));for(var d,f,h=0,m=n.length,v="";h<m;h++)v+=n[h],r[h]!==t&&(f=r[h][0],!0===r[h][2]?d=(f||e.partials[i.recursion])(c,r[h][4]?null:u,r[h][1]):(d=c[f]!==t?c[f]:s(c,u,f),d=i.helpers[f]?i.helpers[f].apply(l(e,c,u),[""].concat(r[h][1])):o(d)?d.apply(l(e,c,u),[""].concat(r[h][1])):"executor"===f.name?f(c,u):d&&(r[h][3]?d:a(d,e))),d!==t&&(v+=d));return v}}function u(e,t,n,i,a){return function(c,u,p){var d=s(c,u,n);if(r(d)){if(a)return d.length?"":t(d,u);for(var f=0,h=d.length,m="";f<h;f++)m+="object"==typeof d[f]?t(d[f],[d[f]].concat(c)):t({".":d[f]},u);return m}return e.options.helpers[n]?e.options.helpers[n].apply(l(e,c,u),[t(c,u)].concat(i.split(/\s+/))):(p=c[n]||d)&&o(p)?p.apply(l(e,c,u),[t(c,u)].concat(i.split(/\s+/))):a&&!p||!a&&p?t(c,u):void 0}}function p(e,t){for(var n=e.options,r=[],i=[],s=[],a=-1,l=n.stopper,d=l+"\\d+"+l,f=t.replace(e.sectionRegExp,function(t,o,i,f,m,v,g){var y=v+o+i+f+g,b=m.lastIndexOf(y);return a++,-1!==b?(s.push(a--),y+m.substring(0,b)+v+o+i+l+h+l+g+m.substring(b+y.length)+v+"/"+i+l+h+++l+g):(i=i.replace(new RegExp(d),""),r.push(new RegExp(n.tags[0]+"[#^]").test(m)?u(e,p(e,m),i,f,"^"===o):u(e,c(e,m),i,f,"^"===o)),n.splitter)}).split(n.splitter),m=0,v=s.length;m<v;m++)f[s[m]]=p(e,f[s[m]]);for(m=0,v=f.length;m<v;m++)i.push(o(f[m])?f[m]:c(e,f[m])),r[m]&&i.push(r[m]);return function(e,t,n){for(var r=0,o=i.length,s="";r<o;r++)s+=i[r](e,t||[e],n)||"";return s}}var d=function(e,t){this.version="0.1.0",this.options={tags:["{{","}}"],entityMap:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},doEscape:!0,helpers:{},partials:{},recursion:"self",characters:'$"<>%-=@',splitter:"|##|",stopper:"__"},f(this,t||{},e)},f=function(e,t,r){for(var o in t)e.options[o]=t[o];t=e.options,e.entityRegExp=function(e,t){for(var n in e)t+=n;return new RegExp("["+t+"]","g")}(t.entityMap,[]),n(e,t.tags),e.partials={};for(var i in t.partials)e.registerPartial(i,t.partials[i]);r&&e.registerPartial(t.recursion,r)},h=0;return d.prototype={render:function(e,t){return t=t&&(r(t)&&t||[t]),this.partials[this.options.recursion](e,t)},parse:function(e){this.partials[this.options.recursion]||this.registerPartial(this.options.recursion,e)},registerHelper:function(e,t){this.options.helpers[e]=t},unregisterHelper:function(e){delete this.options.helpers[e]},registerPartial:function(e,t){return this.partials[e]=p(this,t)},unregisterPartial:function(e){delete this.options.partials[e]},setTags:function(e){n(this,e)}},d}),function(e,t){"object"==typeof exports?module.exports=t(e):"function"==typeof define&&define.amd?define("VOM",[],function(){return t(e)}):e.VOM=t(e)}(this,function(e){"use strict";function t(e,n){for(var r=n.length;r--;)n[r][e.options.childNodes]&&t(e,n[r][e.options.childNodes]),delete p[e.id][n[r][e.options.idProperty]],n.pop();return n}function n(e,t){return e[t]=e[t]||[],e[t]}function r(e,t,r,s,a,c){return e.options.moveCallback.call(e,t,a,c),t.parentNode?e.options.parentCheck&&function(e,t,n){var r=n;t===n&&l("ERROR: can't move element inside itself",e.options);for(;r=r.parentNode;)r===t&&l("ERROR: can't move parent inside it's own child",e.options)}(e,t,r):i([t],e,r,a,c),e.type=a,e.sibling=c,t.parentNode===r&&s>t.index&&-1!==t.index&&s--,t=-1!==t.index&&t.parentNode&&o(e,t,!0)||t,n(r,e.options.childNodes).splice(s||0,0,t),t.parentNode=r,t}function o(e,r,o){return!o&&t(e,[r]),n(r.parentNode,e.options.childNodes).splice(r.index,1)[0]||r}function i(e,t,n,r,o){t.options;for(var a=!1,l=!0,c=t.options.idProperty,u={},m=0,v=e.length;m<v;m++)a=!(u=e[m]).parentNode,u[c]||(u[c]="vom_"+d++,l=!1),p[t.id][u[c]]=u,u.parentNode=n||t.model.root,u.index=0,a&&(u=function(e,t,n){var r=!1,o=e.options.listeners,i=0,a=0,l="",c="",u="",p="",d={},m={},v=[];for(var g in t)if(i=o[g]&&o[g].length-1){a=o[g].indexOf("*"),d=h(t,o[g],a>-1?i-a+1:1),p=o[g].join("."),l=p.split("*")[1]||"",v=l.split(".").splice(1);for(var y in d)m=l?h(d[y],v,1):d,c=p.replace("*",y),u=v[v.length-1]||y,e.addProperty(u,[m,t],c)}else r="parentNode"===g||g===f,g===e.options.idProperty?s(t,g,t[g],n):(o[g]||o["*"]||r)&&e.addProperty(g,t,null,r);return t}(t,u,l)),t.options.preRecursionCallback.call(t,u,r,o),u[t.options.childNodes]&&i(u[t.options.childNodes],t,u),t.options.enrichModelCallback.call(t,u,r,o);return e}function s(e,t,n,r,o){return delete e[t],Object.defineProperty(e,t,{enumerable:!!o,configurable:!1,writable:!!r,value:n})}function a(e,t,r,o,i,s,a){return Object.defineProperty(t[0]||t,e,{get:function(){return e===i?function(e,t){return(t.parentNode?n(t.parentNode,e.options.childNodes):e.model).indexOf(t)}(o,t[0]||t):r[a||e]},set:function(n){var s=r[a||e];r[a||e]=n,function(e,t,n,r,o,i,s){(e===i.options.idProperty||e===s||i.options.subscribe.call(i,i.type||e,t[1]||t,n,r,i.sibling))&&(o[e]=r,l("ERROR: Cannot set property '"+e+"' to '"+n+"'",i.options));delete i.type,delete i.sibling}(a||e,t,n,s,r,o,i)},enumerable:s})}function l(t,n){if(!n.throwErrors&&void 0!==e&&e.console)return console.warn?console.warn(t):console.log(t);throw t}var c=function(e,t){this.options={parentCheck:!1,idProperty:"id",subscribe:function(){},enrichModelCallback:function(){},preRecursionCallback:function(){},moveCallback:function(){},listeners:[],childNodes:"childNodes",throwErrors:!1},this.model=e||[],u(this,t||{})},u=function(e,t){var n="",r={};p.push({}),s(e,"id",p.length-1);for(var o in t)e.options[o]=t[o];for(;n=e.options.listeners.shift();)n=n.split("."),e.options.listeners[n[0]]=n;r[e.options.childNodes]=e.model,s(e.model,"root",r),i(e.model,e)},p=[],d=0,f="index",h=function(e,t,n){for(var r=0,o=t.length-(n||0);r<o;r++)e=e&&e[t[r]];return e};return c.prototype={getElementById:function(e){return p[this.id][e]},getElementsByProperty:function(e,t){var n=[],r=void 0!==t,o=void 0!==e,i=[],s=null;for(var a in p[this.id])s=void 0!==p[this.id][a][e]?p[this.id][a][e]:h(p[this.id][a],i[0]?i:i=o&&e.split(".")),(r&&s===t||!r&&void 0!==s||!r&&!o)&&n.push(p[this.id][a]);return n},appendChild:function(e,t){return t=t||this.model.root,r(this,e,t,n(t,this.options.childNodes).length,"appendChild",t)},prependChild:function(e,t){return t=t||this.model.root,r(this,e,t,0,"prependChild",t)},insertBefore:function(e,t){return r(this,e,t.parentNode,t.index,"insertBefore",t)},insertAfter:function(e,t){return r(this,e,t.parentNode,t.index+1,"insertAfter",t)},replaceChild:function(e,t){var n=t.index,i=t.parentNode;return e!==t&&o(this,t),r(this,e,i,n,"replaceChild",t),t},removeChild:function(e){return o(this,e),this.options.subscribe.call(this,"removeChild",e),e},sortChildren:function(e,t,n){for(var r=0,o=(t=(t||this.model).sort(e)).length;r<o;r++)this.options.subscribe.call(this,"sortChildren",t[r]),n&&t[r][this.options.childNodes]&&this.sort(e,t[r][this.options.childNodes],n)},reinforceProperty:s,addProperty:function(e,t,n,r){var o={};o[n||e]=(t[0]||t)[e],a(e,t,o,this,f,!r,n)},getProperty:function(e,t){return h(t,e.split("."))},getCleanModel:function(e){return JSON.parse(JSON.stringify(e||this.model))},destroy:function(){return t(this,this.model)}},c}),function(e,t){"object"==typeof exports?module.exports=t(e,require("toolbox"),require("schnauzer"),require("VOM")):"function"==typeof define&&define.amd?define("circular",["toolbox","schnauzer","VOM"],function(n,r,o){return t(e,n,r,o)}):e.Circular=t(e,e.Toolbox,e.Schnauzer,e.VOM)}(this,function(e,t,n,r){"use strict";function o(e,t,n){for(var r=0,o=t.length;r<o;r++)t[r].call(e,n)}function i(e){return decodeURI(e?location.hash.substr(e.length):location.pathname+location.search)}function s(e,t){var n=e.regexp&&e.regexp.exec(t),r={};if(!n)return null;for(var o=0,i=(n=n.slice(1)).length;o<i;o++)n[o]=n[o]?o===i-1?n[o]:decodeURIComponent(n[o]):null,e.names[o]&&(r[e.names[o]]=n[o]);return n.parameters=r,n.queries=function(e){for(var t=0,n=(e=e?e.split("&"):[]).length,r={},o=[];t<n;t++)r[(o=e[t].split("="))[0]]=o[1];return r}(n[i-1]),n.path=t.replace(/^\//,"").split("/"),n}function a(e,t,n,r,o){var i="prependChild"===n,s={};"string"==typeof t?(e.innerHTML=t,s=e.children[0]):s=t;return(i||"insertAfter"===n)&&(o=o&&o.nextSibling||i&&r.children[0],n=o?"insertBefore":"appendChild"),(r||s.parentElement)[n](s,o),s}function l(e,t,n){for(var r=v("["+e.viewAttr+"]",n),o="",i=(r=[n].concat([].slice.call(r))).length;i--;)(o=r[i].getAttribute(e.viewAttr))&&(t[o]=r[i])}function c(e,t,n,r,o){for(var i in e.prototype)r[i]||(o[i]=function(e){return function(){return t[e].apply(t,arguments)}}(i));return o}function u(e,t,n){var r=[],o=u.tempContainer=u.tempContainer||document.createDocumentFragment(),i=[],s={};if(n)for(var a=n.length;a--;)(s=n[a])[2][s[1]?"insertBefore":"appendChild"](s[0],s[1]),n[a]=null;else if(e&&t){if(0!==(r=v("["+t+"]",e)).length){a=0;for(var l=r.length;a<l;a++)s=r[a],i.push([s,s.nextElementSibling,s.parentNode]),o.appendChild(s)}return i}}var p=function(e,t){this.options={componentAttr:"cr-component",containerAttr:"cr-container",templateAttr:"cr-template-for",templatesAttr:"cr-template",eventAttribute:"cr-event",viewAttr:"cr-view",devAttribute:"cr-dev",elements:"elements",events:"events",views:"views",hash:"#"},d(this,e,t)},d=function(e,n,r){var o="string"==typeof n;o||(r=n);for(var i in r)e.options[i]=r[i];e.version="0.1.0",e.components={},e.id="cr_"+g++,e.Toolbox=t,e.name=o?n:e.id,C[e.name]={}},f=function(e){this.options={appElement:document.body,eventAttribute:"cr-event"},h(this,e)},h=function(e,t){for(var n in t)e.options[n]=t[n];e.events={}},m=(e.requestAnimationFrame||e.webkitRequestAnimationFrame,t.$),v=t.$$,g=0,y={},b={},x=null,C={},E={};return p.prototype.component=function(e,o){if(this.components[e])return this.components[e].reset(o.model,o.extraModel);var i=this,s={},p={},d=this.options,h=d.elements,g=o.extraModel||d.extraModel,x=d.componentAttr,E="["+x+'="'+e+'"]',N=o.componentElement||m(E,o.componentWrapper||document),R=u(N,x),_=N&&N.getAttribute("name"),w=function(e,t,r,o){for(var i=r||document.body,s=e.containerAttr,a=r.hasAttribute(s)?r:m("["+s+'="'+o+'"]',r)||m("["+s+"]",r),l=m("["+e.templateAttr+'="'+o+'"]',i),c=v("["+e.templatesAttr+'="'+o+'"]',i)||[],u={},p=c.length;p--;)u[c[p].id||c[p].getAttribute("name")]=new(e.Template||n)(c[p].innerHTML,{doEscape:!1,helpers:t.helpers||e.helpers||{}});return{element:r,template:l?l.innerHTML:l,templates:u,container:a}}(d,o,N,_||e),P=this.components[e]={name:e,model:o.model||[],element:w.element,container:w.container};return C[this.name][e]={},P.templates=w.templates,y[this.id]=y[this.id]||{},s=y[this.id][e]={},s.helper=document.createElement("div"),o.onBeforeInit&&o.onBeforeInit(P),s.controller=o.eventListeners&&new f({appElement:w.element,eventAttribute:d.eventAttribute,eventListeners:o.eventListeners,instanceID:i.id}),s.template=o.template&&o.template.version?o.template:b[e]?b[e]:w.template?new(d.Template||n)(o.template||w.template,{doEscape:!1,helpers:o.helpers||d.helpers||{}}):null,s.template&&(b[e]=s.template),s.vom=new r(P.model,{idProperty:i.options.idProperty||"cr-id",preRecursionCallback:function(e,t,n){var r=s.template&&s.template.partials.self&&s.template.render(e,g),i=t||"appendChild",c="replaceChild"===t&&n[h].element,u=e.parentNode[h]&&e.parentNode[h].container,p=r&&f||u||P.container,f=p?c||void 0:n&&n[h].element,v=r&&a(s.helper,r,i,p,f)||P.element;this.reinforceProperty(e,h,{element:v,container:o.mountSelector&&m(o.mountSelector,v)},!0),this.reinforceProperty(e,d.events,{},!0),s.controller&&s.controller.getEventListeners(e[h].element||P.element,e[d.events],P,this.options.idProperty),this.reinforceProperty(e,d.views,{},!0),l(d,e[d.views],e[h].element||P.element),o.preRecursionCallback&&o.preRecursionCallback.call(this,e)},enrichModelCallback:this.options.enrichModelCallback||o.enrichModelCallback||function(){},listeners:this.options.listeners||o.listeners||[],subscribe:function(t,n,r,c,u){var p=n[h]&&n[h].element,f=n.parentNode&&n.parentNode[h]?n.parentNode[h].element:P.container;"removeChild"===t?a(s.helper,p,t,p.parentElement):"sortChildren"===t?a(s.helper,p,"appendChild",f):this[t]&&(n===u?(p=a(s.helper,s.template.render(n,g),t,f,u[h].element),n[h].element=p,n[h].container=o.mountSelector&&m(o.mountSelector,p),n[d.events]={},s.controller&&s.controller.getEventListeners(n[h].element||P.element,n[d.events],P,this.options.idProperty),n[d.views]={},l(d,n[d.views],n[h].element||P.element)):"replaceChild"!==t&&a(s.helper,p,t,f,u[h]&&u[h].element)),o.subscribe&&o.subscribe.call(this,t,n,r,c),i.publish(i.name,e,t,{property:t,item:n,value:r,oldValue:c})}}),u(null,null,R),p=c(n,s.template,0,this,p),p=c(r,s.vom,0,this,{render:p.render}),p.uncloak=function(e){e=e&&e.element||P.element;t.removeClass(e,"cr-cloak"),e.removeAttribute("cr-cloak")},p.reset=function(e,t){s.vom.destroy(),this.container&&(this.container.innerHTML="");for(var n=0,r=e.length;n<r;n++)this.appendChild(e[n]);return P},P.__proto__=p,o.onInit&&o.onInit(P),P},p.prototype.destroy=function(e){var t=y[this.id],n={};for(var r in t)if(!e||e===r)for(var o in t[r])(n=t[r][o])&&n.destroy&&n.destroy(r)},p.prototype.model=function(e,t){return new r(e,t)},p.prototype.template=function(e,t){return new n(e,t)},p.Toolbox=t,p.prototype.subscribe=function(e,t,n,r,o){return e=e||this.name,C[e]=C[e]||{},t=C[e][t]=C[e][t]||{},t[n]=t[n]||[],r&&(t[n].push(r.callback||r),r.regexp&&!t[n].regexp&&(t[n].regexp=r.regexp,t[n].names=r.names)),o&&void 0!==t[n].value&&(r.callback||r).call(this,t[n].value),r.callback||r},p.prototype.publish=function(e,t,n,r){e=e||this.name,C[e]=C[e]||{},C[e]&&((t=C[e][t]=C[e][t]||{})[n]=t[n]||[],t[n].value=r,o(this,t[n],r))},p.prototype.unsubscribe=function(e,t,n,r){var o=-1,i={};return e=e||this.name,C[e]&&C[e][t]&&C[e][t][n]&&-1!==(o=(i=C[e][t][n]).indexOf(r.callback||r))&&i.splice(o,1),r.callback||r},p.prototype.addRoute=function(n,r){var a="object"==typeof n.path?{regexp:n.path}:function(e){var t=[];return e=e.replace(/[\-{}\[\]+?.,\\\^$|#\s]/g,"\\$&").replace(/\((.*?)\)/g,"(?:$1)?").replace(/(\(\?)?:\w+/g,function(e,n){return t.push(e.substr(1)),n?e:"([^/?]+)"}).replace(/\*/g,"([^?]*?)"),{regexp:new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$"),names:t}}(n.path),l=s(a,i(this.options.hash)),c=C[this.name].__router;return this.subscribe(null,"__router",n.path,{callback:n.callback,names:a.names,regexp:a.regexp||a},r),r&&l&&n.callback.call(this,l),!c&&function(n,r){var a=void 0!==e.onpopstate?"popstate":"hashchange",l=r.options.hash;t.addEvent(e,a,function(e){var t={};for(var a in n)(t=s(n[a],i(l)))&&o(r,n[a],t)},r.id)}(C[this.name].__router,this),n},p.prototype.removedRoute=function(e){return this.unsubscribe(null,"__router",e.path,e.callback)},p.prototype.toggleRoute=function(e,t){var n=C[this.name].__router,r=n[e.path].paused||n[e.path];n[e.path]=t?r:[],n[e.path].paused=t?null:r},p.prototype.loadResource=function(e,n){var r=this,o=function(e){return!e.hasAttribute(r.options.devAttribute)};return t.ajax(e,{cache:n}).then(function(t){var n=[],i=e.split("/").slice(0,-1);return x=x||document.implementation.createHTMLDocument(),x.documentElement.innerHTML=t,n=[].slice.call(v("script",x)||[]).filter(function(e){return"text/javascript"===e.getAttribute("type")&&(e.parentNode.removeChild(e),!e.hasAttribute(r.options.devAttribute))}),{links:[].slice.call(v("link",x)||[]).filter(o),styles:[].slice.call(v("style",x)||[]).filter(o),scripts:n,body:m("body",x),head:m("head",x),path:i.join("/")}}).catch()},p.prototype.insertResources=function(e,n){for(t.requireResources(n,"styles",e);n.body.childNodes[0];)e.appendChild(n.body.childNodes[0]);return t.requireResources(n,"scripts",e)},p.prototype.insertComponent=function(e,n){var r=this;return this.loadResource(e,!0).then(function(e){return new t.Promise(function(t){r.insertResources(n,e).then(function(){t(e.path)})})}).catch()},p.prototype.renderComponent=function(e){var n=null,r=E,o=e.name;if(r[e.previousName])for(var i=[].slice.call(e.container.childNodes),s=0,a=i.length;s<a;s++)r[e.previousName].cache.appendChild(i[s]);return o&&r[o]?(r[o].init&&!1!==e.init&&r[o].init(e.data,r[o].path),e.container.appendChild(r[o].cache),new t.Promise(function(e){e(r[o].init)})):(n=document.createDocumentFragment(),o?this.insertComponent(e.path,e.container||n).then(function(i){return new t.Promise(function(t){var s=!0===e.require?o:!1===e.require?"":e.require;r[o]={path:i,cache:n},s?require([s],function(n){r[o].init=n,!1!==e.init&&n(e.data,i),t(n)}):t()})}).catch():new t.Promise(function(e){e()}))},f.prototype={getEventListeners:function(e,t,n,r){for(var o=this.options.eventAttribute,i=e.querySelectorAll("["+o+"]"),s="",a="",l="",c="",u=[],p=e!==n.element?n.element:[],d=(i=[e].concat([].slice.call(i),p)).length;d--;)if(s=i[d].getAttribute(o))for(var f=(u=s.split(/\s*;+\s*/)).length;f--;)l=(a=u[f].split(/\s*:+\s*/))[0],c=a[1],void 0===t[l]&&(t[l]={}),void 0===t[l][c]&&(t[l][c]=[]),t[l][c].push(i[d]),this.events[l]||(this.events[l]=!0);this.installed||this.installEventListeners(n,r)},installEventListeners:function(e,n){var r=this;for(var o in this.events)t.addEvent(this.options.appElement,o,function(o){!function(e,n,r,o){var i=(t.closest(e.target,"["+n+"]")||r.element).getAttribute(n),s=r.getElementById(i)||r.getElementsByProperty("elements.element",r.element)[0];s||(s=r.getElementsByProperty("elements.element",e.target)[0]||r.model[0]);var a=s&&s.events[e.type],l=!1,c={};for(var u in a)for(var p=a[u].length;p--;)c=a[u][p],l||c!==e.target&&!c.contains(e.target)||!o.options.eventListeners[u]||(l=!1===o.options.eventListeners[u].call(r,e,c,s))&&e.stopPropagation()}(o,n,e,r)},!!/(?:focus|blur)/.test(o),this.options.instanceID+"_"+e.name);this.installed=!0},destroy:function(e){t.removeEvent(this.options.instanceID+"_"+e.name)}},p});
