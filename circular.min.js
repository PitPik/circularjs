!function(a,b){"object"==typeof exports?module.exports=b(a):"function"==typeof define&&define.amd?define("Toolbox",[],function(){return b(a)}):a.Toolbox=b(a)}(this,function(a,b){"use strict";var c={closest:function(a,b,c){return a&&a.closest(b)},$:function(a,b){return a.querySelector(b)},$$:function(a,b){return a.querySelectorAll(b)},addEvents:function(a,b,d,e,f){for(var g=a.length;g--;)c.addEvent(a[g],b,d,e,f)},removeEvents:function(a,b,d){for(var e=b.length;e--;)c.removeEvent(a,b[e],d)},addEvent:function(a,b,d,e,f){c.addEvent.events=c.addEvent.events||[],c.addEvent.events.push({e:a,t:b,f:d,c:e,i:f||c}),a.addEventListener(b,d,e)},removeEvent:function(a,b,d){var e={},f=!1,g=0;for(g=(c.addEvent.events||[]).length;g--;)e=c.addEvent.events[g],f=!b||e.e===b&&(!d||d===e.t),e.i===(a||c)&&f&&(e.e.removeEventListener(e.t,e.f,e.c),c.addEvent.events.splice(g,1))}};return c}),function(a,b){"object"==typeof exports?module.exports=b(a):"function"==typeof define&&define.amd?define("Schnauzer",[],function(){return b(a)}):a.Schnauzer=b(a)}(this,function(a,b){"use strict";function c(a,b){var c="{{"===b[0],d=c?["{{2,3}","}{2,3}"]:b;a.options.tags=d,a.variableRegExp=new RegExp("("+d[0]+")([>!&=]\\s*)*([\\w\\"+a.options.characters+"\\.\\s*]+)*"+d[1],"g"),a.sectionRegExp=new RegExp(d[0]+"(#|\\^)([\\w\\.]*)\\s*(.*?)"+d[1]+"([\\S\\s]*?)("+d[0]+")\\/\\2("+d[1]+")","g")}function d(a){return a&&a.constructor===Array}function e(a){return a&&"function"==typeof a}function f(a,b){for(var c=0,d=b.length;c<d;c++)a=a&&a[b[c]];return a}function g(a,c,d){if("string"==typeof d){var e=[],g=a[d]!==b?a[d]:f(a,e=d.split("."));if(g!==b)return g;for(var h=c.length;h--;){if(c[h][d]!==b)return c[h][d];if(g=f(c[h],e))return g}}}function h(a,b){return String(a).replace(b.entityRegExp,function(a){return b.options.entityMap[a]})}function i(a,b,c){return{getData:function(a){return g(b,c,a)},escapeHtml:function(b){return h(b,a)}}}function j(a,c){var d=[],f=a.options;return c=c.replace(a.variableRegExp,function(b,c,e,g){var h=e&&("!"===e[0]||"="===e[0]),i=!f.doEscape||"{{{"===c||e&&"&"===e[0],j=e&&">"===e[0],k=!1,l="",m={};if(h)return"";if(g=g.split(/\s+/),l=g.shift(g),j)for(var n=g.length,o=[];n--;)o=g[n].split("="),m[o[1]?o[0]:"$"+n]=(o[1]?o[1]:o[0]).replace(/"/g,"");return k=l===f.recursion,d.push(j&&(a.partials[l]||k)?[a.partials[l],m,j,i,k]:[l,g,null,i]),f.splitter}).split(f.splitter),function(j,k,l){l&&(k=[l].concat(k));for(var m,n,o=0,p=c.length,q="";o<p;o++)q+=c[o],d[o]!==b&&(n=d[o][0],d[o][2]===!0?m=(n||a.partials[f.recursion])(j,d[o][4]?null:k,d[o][1]):(m=j[n]!==b?j[n]:g(j,k,n),m=f.helpers[n]?f.helpers[n].apply(i(a,j,k),[""].concat(d[o][1])):e(m)?m.apply(i(a,j,k),[""].concat(d[o][1])):"executor"===n.name?n(j,k):m&&(d[o][3]?m:h(m,a))),m!==b&&(q+=m));return q}}function k(a,b,c,f,h){return function(j,k,l){if(d(j[c])){if(j=j[c],h)return j.length?"":b(j,k);for(var m=0,n=j.length,o="";m<n;m++)o+="object"==typeof j[m]?b(j[m],[j[m]].concat(k)):b({".":j[m]},k);return o}return a.options.helpers[c]?a.options.helpers[c].apply(i(a,j,k),[b(j,k)].concat(f.split(/\s+/))):(l=j[c]||g(j,k,c),l&&e(l)?l.apply(i(a,j,k),[b(j,k)].concat(f.split(/\s+/))):h&&!l||!h&&l?b(j,k):void 0)}}function l(a,b){for(var c=a.options,d=[],f=[],g=[],h=-1,i=c.stopper,m=i+"\\d+"+i,n=b.replace(a.sectionRegExp,function(b,e,f,n,p,q,r){var s=q+e+f+n+r,t=p.lastIndexOf(s);return h++,t!==-1?(g.push(h--),s+p.substring(0,t)+q+e+f+i+o+i+r+p.substring(t+s.length)+q+"/"+f+i+o+++i+r):(f=f.replace(new RegExp(m),""),d.push(new RegExp(c.tags[0]+"[#^]").test(p)?k(a,l(a,p),f,n):k(a,j(a,p),f,n,"^"===e)),c.splitter)}).split(c.splitter),p=0,q=g.length;p<q;p++)n[g[p]]=l(a,n[g[p]]);for(var p=0,q=n.length;p<q;p++)f.push(e(n[p])?n[p]:j(a,n[p])),d[p]&&f.push(d[p]);return function(a,b,c){for(var d=0,e=f.length,g="";d<e;d++)g+=f[d](a,b||[a],c)||"";return g}}var m=function(a,b){this.version="0.1.0",this.options={tags:["{{","}}"],entityMap:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},doEscape:!0,helpers:{},partials:{},recursion:"self",characters:'$"<>%=@',splitter:"|##|",stopper:"__"},n(this,b||{},a)},n=function(a,b,d){for(var e in b)a.options[e]=b[e];b=a.options,a.entityRegExp=function(a,b){for(var c in a)b+=c;return new RegExp("["+b+"]","g")}(b.entityMap,[]),c(a,b.tags),a.partials={};for(var f in b.partials)a.registerPartial(f,b.partials[f]);d&&a.registerPartial(b.recursion,d)},o=0;return m.prototype={render:function(a){return this.partials[this.options.recursion](a)},parse:function(a){this.partials[this.options.recursion]||this.registerPartial(this.options.recursion,a)},registerHelper:function(a,b){this.options.helpers[a]=b},unregisterHelper:function(a){delete this.options.helpers[a]},registerPartial:function(a,b){return this.partials[a]=l(this,b)},unregisterPartial:function(a){delete this.options.partials[a]},setTags:function(a){c(this,a)}},m}),function(a,b){"object"==typeof exports?module.exports=b(a):"function"==typeof define&&define.amd?define("VOM",[],function(){return b(a)}):a.VOM=b(a)}(this,function(a){"use strict";function b(a,c){for(var d=c.length;d--;)c[d][a.options.childNodes]&&b(a,c[d][a.options.childNodes]),delete p[a.id][c[d][a.options.idProperty]];return c}function c(a,b){return(b.parentNode?d(b.parentNode,a.options.childNodes):a.model).indexOf(b)}function d(a,b){return a[b]=a[b]||[],a[b]}function e(a,b,c,e,i,j){return a.options.moveCallback.call(a,b,i,j),b.parentNode?a.options.parentCheck&&g(a,b,c):h([b],a,c,i,j),a.type=i,a.sibling=j,b.parentNode===c&&e>b.index&&b.index!==-1&&e--,b=b.index!==-1&&b.parentNode&&f(a,b,!0)||b,d(c,a.options.childNodes).splice(e||0,0,b),b.parentNode=c,b}function f(a,c,e){return!e&&b(a,[c]),d(c.parentNode,a.options.childNodes).splice(c.index,1)[0]||c}function g(a,b,c){var d=c;for(b===c&&m("ERROR: can't move element inside itself",a.options);d=d.parentNode;)d===b&&m("ERROR: can't move parent inside it's own child",a.options)}function h(a,b,c,d,e){for(var f=(b.options,!1),g=!0,j=b.options.idProperty,k={},l=0,m=a.length;l<m;l++)k=a[l],f=!k.parentNode,k[j]||(k[j]="vom_"+q++,g=!1),p[b.id][k[j]]=k,k.parentNode=c||b.model.root,k.index=0,f&&(k=i(b,k,g)),b.options.preRecursionCallback.call(b,k,d,e),k[b.options.childNodes]&&h(k[b.options.childNodes],b,k),b.options.enrichModelCallback.call(b,k,d,e);return a}function i(a,b,c){var d=!1,e=a.options.enhanceMap,f=0,g=0,h="",i="",k="",l="",m={},n={},o=[];for(var p in b)if(f=e[p]&&e[p].length-1){g=e[p].indexOf("*"),m=s(b,e[p],g>-1?f-g+1:1),l=e[p].join("."),h=l.split("*")[1]||"",o=h.split(".").splice(1);for(var q in m)n=h?s(m[q],o,1):m,i=l.replace("*",q),k=o[o.length-1]||q,a.addProperty(k,n,i)}else d="parentNode"===p||p===r,p===a.options.idProperty?j(b,p,b[p],c):(e[p]||e["*"]&&1===e.length||d)&&a.addProperty(p,b,null,d);return b}function j(a,b,c,d){return delete a[b],Object.defineProperty(a,b,{enumerable:!!d,configurable:!1,writable:!1,value:c})}function k(a,b,d,e,f,g,h){return Object.defineProperty(b,a,{get:function(){return a===f?c(e,b):d[h||a]},set:function(c){var g=d[h||a];d[h||a]=c,l(h||a,b,c,g,d,e,f)},enumerable:g})}function l(a,b,c,d,e,f,g){(a===f.options.idProperty||a===g||f.options.setterCallback.call(f,f.type||a,b,c,d,f.sibling))&&(e[a]=d,m("ERROR: Cannot set property '"+a+"' to '"+c+"'",f.options)),delete f.type,delete f.sibling}function m(b,c){if(!c.throwErrors&&void 0!==a&&a.console)return console.warn?console.warn(b):console.log(b);throw b}var n=function(a,b){this.options={parentCheck:!1,idProperty:"id",setterCallback:function(){},enrichModelCallback:function(){},preRecursionCallback:function(){},moveCallback:function(){},enhanceMap:[],childNodes:"childNodes",throwErrors:!1},this.model=a||[],o(this,b||{})},o=function(a,b){var c="",d={};p.push({}),j(a,"id",p.length-1);for(var e in b)a.options[e]=b[e];for(;c=a.options.enhanceMap.shift();)c=c.split("."),a.options.enhanceMap[c[0]]=c;d[a.options.childNodes]=a.model,j(a.model,"root",d),h(a.model,a)},p=[],q=0,r="index",s=function(a,b,c){for(var d=0,e=b.length-(c||0);d<e;d++)a=a&&a[b[d]];return a};return n.prototype={getElementById:function(a){return p[this.id][a]},getElementsByProperty:function(a,b){var c=[],d=void 0!==b,e=void 0!==a,f=[],g=null;for(var h in p[this.id])g=void 0!==p[this.id][h][a]?p[this.id][h][a]:s(p[this.id][h],f[0]?f:f=e&&a.split(".")),(d&&g===b||!d&&void 0!==g||!d&&!e)&&c.push(p[this.id][h]);return c},appendChild:function(a,b){return b=b||this.model.root,e(this,a,b,d(b,this.options.childNodes).length,"appendChild",b)},prependChild:function(a,b){return e(this,a,b||this.model.root,0,"prependChild",b)},insertBefore:function(a,b){return e(this,a,b.parentNode,b.index,"insertBefore",b)},insertAfter:function(a,b){return e(this,a,b.parentNode,b.index+1,"insertAfter",b)},replaceChild:function(a,b){var c=b.index,d=b.parentNode;return f(this,b),e(this,a,d,c,"replaceChild",b),b},removeChild:function(a){return f(this,a),this.options.setterCallback.call(this,"removeChild",a),a},reinforceProperty:j,addProperty:function(a,b,c,d){var e={};e[c||a]=b[a],k(a,b,e,this,r,!d,c)},getCleanModel:function(){return JSON.parse(JSON.stringify(this.model))},destroy:function(){return b(this,this.model)}},n}),function(a,b){"object"==typeof exports?module.exports=b(a):"function"==typeof define&&define.amd?define("DOMinator",[],function(){return b(a)}):a.DOMinator=b(a)}(this,function(a){"use strict";var b=function(a){this.options={},c(this,a)},c=function(a,b){for(var c in b)a.options[c]=b[c];a.version="0.1.0",a.fragment=document.createDocumentFragment(),a.helper=document.createElement("div")},d=function(a,b){clearTimeout(a.timer),a.func=b,a.timer=setTimeout(b,0)},e=!1;return b.prototype={render:function(a,b,c,f,g){var h=this,i={},j={},k="string"==typeof a;return k?(this.helper.innerHTML=a,j=this.helper.children[0]):j=a,f&&e?i=f.appendChild(j):(i=k?this.fragment.appendChild(j):j,!e&&d(this,function(){e=!1,"prependChild"===c&&b.children.length?b.insertBefore(h.fragment,b.children[0]):"insertBefore"===c?g.parentNode.insertBefore(h.fragment,g):"insertAfter"===c&&g.nextSibling?g.parentNode.insertBefore(h.fragment,g.nextSibling):"replaceChild"===c?g.parentNode.replaceChild(h.fragment,g):b.appendChild(h.fragment)})),e=!0,i},appendImmediately:function(){this.func&&(clearTimeout(this.timer),this.func(),delete this.func)}},b}),function(a,b){"object"==typeof exports?module.exports=b(a,require("toolbox")):"function"==typeof define&&define.amd?define("controller",["toolbox"],function(c){return b(a,c)}):a.Controller=b(a,a.Toolbox)}(this,function(a,b){"use strict";var c=function(a){this.options={appElement:document.body,eventAttribute:"cr-event"},d(this,a)},d=function(a,c){for(var d in c)a.options[d]=c[d];a.events={};var e=a;a.eventDistributor=function(a,c,d){var f=b.closest(a.target,"["+c+"]")||d.element,g=f.getAttribute(c),h=d.getElementById(g)||d.getElementsByProperty("elements.element",d.element)[0];h||(h=d.getElementsByProperty("elements.element",a.target)[0]);var i=h&&h.events[a.type],j=!1,k={};for(var l in i)for(var m=i[l].length;m--;)k=i[l][m],j||k!==a.target&&!k.contains(a.target)||!e.options.eventListeners[l]||(j=e.options.eventListeners[l].call(d,a,k,h)===!1)}};return c.prototype={getEventListeners:function(a,b,c,d){var e=b.querySelectorAll("["+this.options.eventAttribute+"]"),f="",g="",h="",i="",j=[];e=[b].concat([].slice.call(e));for(var k=e.length;k--;)if(f=e[k].getAttribute(this.options.eventAttribute)){j=f.split(/\s*;+\s*/);for(var l=j.length;l--;)g=j[l].split(/\s*:+\s*/),h=g[0],i=g[1],void 0===c[h]&&(c[h]={}),void 0===c[h][i]&&(c[h][i]=[]),c[h][i].push(e[k]),this.events[h]||(this.events[h]=!0)}this.installed||this.events==={}||this.installEventListeners(a,d)},installEventListeners:function(a,c){var d=this;for(var e in this.events)b.addEvent(this.options.appElement,e,function(b){d.eventDistributor(b,a.options.idProperty,c)},!!/(?:focus|blur)/.test(e),this);this.installed=!0},destroy:function(){b.removeEvent(this)}},c}),function(a,b){"object"==typeof exports?module.exports=b(a,require("toolbox"),require("controller"),require("template"),require("VOM"),require("DOMinator")):"function"==typeof define&&define.amd?define("circular",["toolbox","controller","template","VOM","DOMinator"],function(c,d,e,f,g){return b(a,c,d,e,f,g)}):a.Circular=b(a,a.Toolbox,a.Controller,a.Template,a.VOM,a.DOMinator)}(this,function(a,b,c,d,e,f){"use strict";function g(a,b,c){var d=n(c,"["+a.viewAttr+"]"),e="";d=[c].concat([].slice.call(d));for(var f=d.length;f--;)(e=d[f].getAttribute(a.viewAttr))&&(b[e]=d[f])}function h(a,b,c,d,e){for(var f in a.prototype)d[f]||(e[f]=function(a){return function(){return b[a].apply(b,arguments)}}(f));return e}function i(a,b,c){var d={},e={};if(c)c[0]?c[1].insertBefore(c[2],c[0]):c[1].appendChild(c[2]);else if(a&&b)return d=m(a,"["+b+"]"),d&&(e=document.createDocumentFragment(),c=[d.nextSibling,d.parentNode,e],e.appendChild(d)),c}function j(a,b,c){for(var d=a.containerAttr,e=b.hasAttribute(d)?b:m(b,"["+d+'="'+c+'"]')||m(b,"["+d+"]"),f=m(document,"["+a.templateAttr+'="'+c+'"]'),g=n(document,"["+a.templatesAttr+'="'+c+'"]')||[],h={},i=g.length;i--;)h[g[i].id]=new(a.Template||Schnauzer)(g[i].innerHTML);return{element:b,template:f?f.innerHTML:f,templates:h,container:e}}var k=function(a){this.options={componentAttr:"cr-component",containerAttr:"cr-container",templateAttr:"cr-template-for",templatesAttr:"cr-template",eventAttribute:"cr-event",viewAttr:"cr-view",elements:"elements",events:"events",views:"views"},l(this,a)},l=function(a,b){for(var c in b)a.options[c]=b[c];a.version="0.1.0",a.components={},a.id="cr_"+o++},m=b.$,n=b.$$,o=0,p={};return k.prototype.component=function(a,b){var d={},k={},l=this.options,n=l.componentAttr,o=m(document,"["+n+'="'+a+'"]'),q=i(o,n),r=j(l,o,a),s=this.components[a]={name:a,model:b.model||[{__init:!0}],element:r.element,container:r.container};return p[this.id]=p[this.id]||{},d=p[this.id][a]={},d.dominator=new f({}),d.controller=b.eventListeners&&new c({appElement:r.element,eventListeners:b.eventListeners}),d.template=r.template?new(l.Template||Schnauzer)(b.template||r.template,{doEscape:!1,helpers:this.options.helpers||{}}):null,s.templates=r.templates,d.vom=new e(s.model,{preRecursionCallback:function(a,c,e){var f=d.template&&d.template.partials.self&&d.template.render(a),h=a.parentNode.elements&&a.parentNode.elements.container,i=e&&e.elements&&e.elements.element,j=f&&i||s.container,k=j&&d.dominator.render(f,j,c,h,i)||s.element;this.isNew=!0,this.reinforceProperty(a,l.elements,{element:k,container:b.mountSelector&&m(k,b.mountSelector)}),this.reinforceProperty(a,l.events,{}),d.controller&&d.controller.getEventListeners(this,a[l.elements].element||s.element,a[l.events],s),this.reinforceProperty(a,l.views,{}),g(l,a[l.views],a[l.elements].element||s.element),this.options.vom&&this.options.vom.preRecursionCallback&&this.options.vom.preRecursionCallback(a)},enrichModelCallback:this.options.enrichModelCallback||function(){},enhanceMap:this.options.enhanceMap||b.enhanceMap||[],setterCallback:function(a,c,e,f,g){if("removeChild"===a){c.elements.element.parentElement.removeChild(c.elements.element)}else!this.isNew&&d.vom[a]&&d.dominator.render(c.elements.element,c.parentNode.elements.element,a,null,g.elements.element);b.setterCallback&&b.setterCallback.call(this,a,c,e,f),delete this.isNew},moveCallback:function(a,b,c){"appendChild"!==b&&d.dominator.appendImmediately()}}),i(null,null,q),k=h(e,d.vom,s,this,k),s.__proto__=k,s},k.prototype.destroy=function(){var a=p[this.id];for(var b in a)for(var c in a[b])a[b][c].destroy&&a[b][c].destroy()},k});
//# sourceMappingURL=circular.js.map